{"ast":null,"code":"import { getGlobalObject } from '@sentry/utils';\nvar global = getGlobalObject();\n/**\n * Creates routing instrumentation for React Router v3\n * Works for React Router >= 3.2.0 and < 4.0.0\n *\n * @param history object from the `history` library\n * @param routes a list of all routes, should be\n * @param match `Router.match` utility\n */\nexport function reactRouterV3Instrumentation(history, routes, match) {\n  return function (startTransaction, startTransactionOnPageLoad, startTransactionOnLocationChange) {\n    if (startTransactionOnPageLoad === void 0) {\n      startTransactionOnPageLoad = true;\n    }\n    if (startTransactionOnLocationChange === void 0) {\n      startTransactionOnLocationChange = true;\n    }\n    var activeTransaction;\n    var prevName;\n    // Have to use global.location because history.location might not be defined.\n    if (startTransactionOnPageLoad && global && global.location) {\n      normalizeTransactionName(routes, global.location, match, function (localName) {\n        prevName = localName;\n        activeTransaction = startTransaction({\n          name: prevName,\n          op: 'pageload',\n          tags: {\n            'routing.instrumentation': 'react-router-v3'\n          }\n        });\n      });\n    }\n    if (startTransactionOnLocationChange && history.listen) {\n      history.listen(function (location) {\n        if (location.action === 'PUSH' || location.action === 'POP') {\n          if (activeTransaction) {\n            activeTransaction.finish();\n          }\n          var tags_1 = {\n            'routing.instrumentation': 'react-router-v3'\n          };\n          if (prevName) {\n            tags_1.from = prevName;\n          }\n          normalizeTransactionName(routes, location, match, function (localName) {\n            prevName = localName;\n            activeTransaction = startTransaction({\n              name: prevName,\n              op: 'navigation',\n              tags: tags_1\n            });\n          });\n        }\n      });\n    }\n  };\n}\n/**\n * Normalize transaction names using `Router.match`\n */\nfunction normalizeTransactionName(appRoutes, location, match, callback) {\n  var name = location.pathname;\n  match({\n    location: location,\n    routes: appRoutes\n  }, function (error, _redirectLocation, renderProps) {\n    if (error || !renderProps) {\n      return callback(name);\n    }\n    var routePath = getRouteStringFromRoutes(renderProps.routes || []);\n    if (routePath.length === 0 || routePath === '/*') {\n      return callback(name);\n    }\n    name = routePath;\n    return callback(name);\n  });\n}\n/**\n * Generate route name from array of routes\n */\nfunction getRouteStringFromRoutes(routes) {\n  if (!Array.isArray(routes) || routes.length === 0) {\n    return '';\n  }\n  var routesWithPaths = routes.filter(function (route) {\n    return !!route.path;\n  });\n  var index = -1;\n  for (var x = routesWithPaths.length - 1; x >= 0; x--) {\n    var route = routesWithPaths[x];\n    if (route.path && route.path.startsWith('/')) {\n      index = x;\n      break;\n    }\n  }\n  return routesWithPaths.slice(index).filter(function (_a) {\n    var path = _a.path;\n    return !!path;\n  }).map(function (_a) {\n    var path = _a.path;\n    return path;\n  }).join('');\n}","map":{"version":3,"names":["getGlobalObject","global","reactRouterV3Instrumentation","history","routes","match","startTransaction","startTransactionOnPageLoad","startTransactionOnLocationChange","activeTransaction","prevName","location","normalizeTransactionName","localName","name","op","tags","listen","action","finish","tags_1","from","appRoutes","callback","pathname","error","_redirectLocation","renderProps","routePath","getRouteStringFromRoutes","length","Array","isArray","routesWithPaths","filter","route","path","index","x","startsWith","slice","_a","map","join"],"sources":["../../src/reactrouterv3.ts"],"sourcesContent":["import { Primitive, Transaction, TransactionContext } from '@sentry/types';\nimport { getGlobalObject } from '@sentry/utils';\n\nimport { Location, ReactRouterInstrumentation } from './types';\n\n// Many of the types below had to be mocked out to prevent typescript issues\n// these types are required for correct functionality.\n\ntype HistoryV3 = {\n  location?: Location;\n  listen?(cb: (location: Location) => void): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n} & Record<string, any>;\n\nexport type Route = { path?: string; childRoutes?: Route[] };\n\nexport type Match = (\n  props: { location: Location; routes: Route[] },\n  cb: (error?: Error, _redirectLocation?: Location, renderProps?: { routes?: Route[] }) => void,\n) => void;\n\nconst global = getGlobalObject<Window>();\n\n/**\n * Creates routing instrumentation for React Router v3\n * Works for React Router >= 3.2.0 and < 4.0.0\n *\n * @param history object from the `history` library\n * @param routes a list of all routes, should be\n * @param match `Router.match` utility\n */\nexport function reactRouterV3Instrumentation(\n  history: HistoryV3,\n  routes: Route[],\n  match: Match,\n): ReactRouterInstrumentation {\n  return (\n    startTransaction: (context: TransactionContext) => Transaction | undefined,\n    startTransactionOnPageLoad: boolean = true,\n    startTransactionOnLocationChange: boolean = true,\n  ) => {\n    let activeTransaction: Transaction | undefined;\n    let prevName: string | undefined;\n\n    // Have to use global.location because history.location might not be defined.\n    if (startTransactionOnPageLoad && global && global.location) {\n      normalizeTransactionName(routes, global.location as unknown as Location, match, (localName: string) => {\n        prevName = localName;\n        activeTransaction = startTransaction({\n          name: prevName,\n          op: 'pageload',\n          tags: {\n            'routing.instrumentation': 'react-router-v3',\n          },\n        });\n      });\n    }\n\n    if (startTransactionOnLocationChange && history.listen) {\n      history.listen(location => {\n        if (location.action === 'PUSH' || location.action === 'POP') {\n          if (activeTransaction) {\n            activeTransaction.finish();\n          }\n          const tags: Record<string, Primitive> = {\n            'routing.instrumentation': 'react-router-v3',\n          };\n          if (prevName) {\n            tags.from = prevName;\n          }\n          normalizeTransactionName(routes, location, match, (localName: string) => {\n            prevName = localName;\n            activeTransaction = startTransaction({\n              name: prevName,\n              op: 'navigation',\n              tags,\n            });\n          });\n        }\n      });\n    }\n  };\n}\n\n/**\n * Normalize transaction names using `Router.match`\n */\nfunction normalizeTransactionName(\n  appRoutes: Route[],\n  location: Location,\n  match: Match,\n  callback: (pathname: string) => void,\n): void {\n  let name = location.pathname;\n  match(\n    {\n      location,\n      routes: appRoutes,\n    },\n    (error, _redirectLocation, renderProps) => {\n      if (error || !renderProps) {\n        return callback(name);\n      }\n\n      const routePath = getRouteStringFromRoutes(renderProps.routes || []);\n      if (routePath.length === 0 || routePath === '/*') {\n        return callback(name);\n      }\n\n      name = routePath;\n      return callback(name);\n    },\n  );\n}\n\n/**\n * Generate route name from array of routes\n */\nfunction getRouteStringFromRoutes(routes: Route[]): string {\n  if (!Array.isArray(routes) || routes.length === 0) {\n    return '';\n  }\n\n  const routesWithPaths: Route[] = routes.filter((route: Route) => !!route.path);\n\n  let index = -1;\n  for (let x = routesWithPaths.length - 1; x >= 0; x--) {\n    const route = routesWithPaths[x];\n    if (route.path && route.path.startsWith('/')) {\n      index = x;\n      break;\n    }\n  }\n\n  return routesWithPaths\n    .slice(index)\n    .filter(({ path }) => !!path)\n    .map(({ path }) => path)\n    .join('');\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}