{"ast":null,"code":"import { __read } from \"tslib\";\n// global reference to slice\nvar UNKNOWN_FUNCTION = '?';\nvar OPERA10_PRIORITY = 10;\nvar OPERA11_PRIORITY = 20;\nvar CHROME_PRIORITY = 30;\nvar WINJS_PRIORITY = 40;\nvar GECKO_PRIORITY = 50;\nfunction createFrame(filename, func, lineno, colno) {\n  var frame = {\n    filename: filename,\n    function: func,\n    // All browser frames are considered in_app\n    in_app: true\n  };\n  if (lineno !== undefined) {\n    frame.lineno = lineno;\n  }\n  if (colno !== undefined) {\n    frame.colno = colno;\n  }\n  return frame;\n}\n// Chromium based browsers: Chrome, Brave, new Opera, new Edge\nvar chromeRegex = /^\\s*at (?:(.*?) ?\\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i;\nvar chromeEvalRegex = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/;\nvar chrome = function (line) {\n  var parts = chromeRegex.exec(line);\n  if (parts) {\n    var isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\n    if (isEval) {\n      var subMatch = chromeEvalRegex.exec(parts[2]);\n      if (subMatch) {\n        // throw out eval line/column and use top-most line/column number\n        parts[2] = subMatch[1]; // url\n        parts[3] = subMatch[2]; // line\n        parts[4] = subMatch[3]; // column\n      }\n    }\n    // Kamil: One more hack won't hurt us right? Understanding and adding more rules on top of these regexps right now\n    // would be way too time consuming. (TODO: Rewrite whole RegExp to be more readable)\n    var _a = __read(extractSafariExtensionDetails(parts[1] || UNKNOWN_FUNCTION, parts[2]), 2),\n      func = _a[0],\n      filename = _a[1];\n    return createFrame(filename, func, parts[3] ? +parts[3] : undefined, parts[4] ? +parts[4] : undefined);\n  }\n  return;\n};\nexport var chromeStackParser = [CHROME_PRIORITY, chrome];\n// gecko regex: `(?:bundle|\\d+\\.js)`: `bundle` is for react native, `\\d+\\.js` also but specifically for ram bundles because it\n// generates filenames without a prefix like `file://` the filenames in the stacktrace are just 42.js\n// We need this specific case for now because we want no other regex to match.\nvar geckoREgex = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\\/.*?|\\[native code\\]|[^@]*(?:bundle|\\d+\\.js)|\\/[\\w\\-. /=]+)(?::(\\d+))?(?::(\\d+))?\\s*$/i;\nvar geckoEvalRegex = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i;\nvar gecko = function (line) {\n  var _a;\n  var parts = geckoREgex.exec(line);\n  if (parts) {\n    var isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\n    if (isEval) {\n      var subMatch = geckoEvalRegex.exec(parts[3]);\n      if (subMatch) {\n        // throw out eval line/column and use top-most line number\n        parts[1] = parts[1] || 'eval';\n        parts[3] = subMatch[1];\n        parts[4] = subMatch[2];\n        parts[5] = ''; // no column when eval\n      }\n    }\n    var filename = parts[3];\n    var func = parts[1] || UNKNOWN_FUNCTION;\n    _a = __read(extractSafariExtensionDetails(func, filename), 2), func = _a[0], filename = _a[1];\n    return createFrame(filename, func, parts[4] ? +parts[4] : undefined, parts[5] ? +parts[5] : undefined);\n  }\n  return;\n};\nexport var geckoStackParser = [GECKO_PRIORITY, gecko];\nvar winjsRegex = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i;\nvar winjs = function (line) {\n  var parts = winjsRegex.exec(line);\n  return parts ? createFrame(parts[2], parts[1] || UNKNOWN_FUNCTION, +parts[3], parts[4] ? +parts[4] : undefined) : undefined;\n};\nexport var winjsStackParser = [WINJS_PRIORITY, winjs];\nvar opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i;\nvar opera10 = function (line) {\n  var parts = opera10Regex.exec(line);\n  return parts ? createFrame(parts[2], parts[3] || UNKNOWN_FUNCTION, +parts[1]) : undefined;\n};\nexport var opera10StackParser = [OPERA10_PRIORITY, opera10];\nvar opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\\(.*\\))? in (.*):\\s*$/i;\nvar opera11 = function (line) {\n  var parts = opera11Regex.exec(line);\n  return parts ? createFrame(parts[5], parts[3] || parts[4] || UNKNOWN_FUNCTION, +parts[1], +parts[2]) : undefined;\n};\nexport var opera11StackParser = [OPERA11_PRIORITY, opera11];\n/**\n * Safari web extensions, starting version unknown, can produce \"frames-only\" stacktraces.\n * What it means, is that instead of format like:\n *\n * Error: wat\n *   at function@url:row:col\n *   at function@url:row:col\n *   at function@url:row:col\n *\n * it produces something like:\n *\n *   function@url:row:col\n *   function@url:row:col\n *   function@url:row:col\n *\n * Because of that, it won't be captured by `chrome` RegExp and will fall into `Gecko` branch.\n * This function is extracted so that we can use it in both places without duplicating the logic.\n * Unfortunately \"just\" changing RegExp is too complicated now and making it pass all tests\n * and fix this case seems like an impossible, or at least way too time-consuming task.\n */\nvar extractSafariExtensionDetails = function (func, filename) {\n  var isSafariExtension = func.indexOf('safari-extension') !== -1;\n  var isSafariWebExtension = func.indexOf('safari-web-extension') !== -1;\n  return isSafariExtension || isSafariWebExtension ? [func.indexOf('@') !== -1 ? func.split('@')[0] : UNKNOWN_FUNCTION, isSafariExtension ? \"safari-extension:\" + filename : \"safari-web-extension:\" + filename] : [func, filename];\n};","map":{"version":3,"names":["UNKNOWN_FUNCTION","OPERA10_PRIORITY","OPERA11_PRIORITY","CHROME_PRIORITY","WINJS_PRIORITY","GECKO_PRIORITY","createFrame","filename","func","lineno","colno","frame","function","in_app","undefined","chromeRegex","chromeEvalRegex","chrome","line","parts","exec","isEval","indexOf","subMatch","_a","__read","extractSafariExtensionDetails","chromeStackParser","geckoREgex","geckoEvalRegex","gecko","geckoStackParser","winjsRegex","winjs","winjsStackParser","opera10Regex","opera10","opera10StackParser","opera11Regex","opera11","opera11StackParser","isSafariExtension","isSafariWebExtension","split"],"sources":["../../../src/stack-parsers.ts"],"sourcesContent":["import { StackFrame } from '@sentry/types';\nimport { StackLineParser, StackLineParserFn } from '@sentry/utils';\n\n// global reference to slice\nconst UNKNOWN_FUNCTION = '?';\n\nconst OPERA10_PRIORITY = 10;\nconst OPERA11_PRIORITY = 20;\nconst CHROME_PRIORITY = 30;\nconst WINJS_PRIORITY = 40;\nconst GECKO_PRIORITY = 50;\n\nfunction createFrame(filename: string, func: string, lineno?: number, colno?: number): StackFrame {\n  const frame: StackFrame = {\n    filename,\n    function: func,\n    // All browser frames are considered in_app\n    in_app: true,\n  };\n\n  if (lineno !== undefined) {\n    frame.lineno = lineno;\n  }\n\n  if (colno !== undefined) {\n    frame.colno = colno;\n  }\n\n  return frame;\n}\n\n// Chromium based browsers: Chrome, Brave, new Opera, new Edge\nconst chromeRegex =\n  /^\\s*at (?:(.*?) ?\\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i;\nconst chromeEvalRegex = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/;\n\nconst chrome: StackLineParserFn = line => {\n  const parts = chromeRegex.exec(line);\n\n  if (parts) {\n    const isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\n\n    if (isEval) {\n      const subMatch = chromeEvalRegex.exec(parts[2]);\n\n      if (subMatch) {\n        // throw out eval line/column and use top-most line/column number\n        parts[2] = subMatch[1]; // url\n        parts[3] = subMatch[2]; // line\n        parts[4] = subMatch[3]; // column\n      }\n    }\n\n    // Kamil: One more hack won't hurt us right? Understanding and adding more rules on top of these regexps right now\n    // would be way too time consuming. (TODO: Rewrite whole RegExp to be more readable)\n    const [func, filename] = extractSafariExtensionDetails(parts[1] || UNKNOWN_FUNCTION, parts[2]);\n\n    return createFrame(filename, func, parts[3] ? +parts[3] : undefined, parts[4] ? +parts[4] : undefined);\n  }\n\n  return;\n};\n\nexport const chromeStackParser: StackLineParser = [CHROME_PRIORITY, chrome];\n\n// gecko regex: `(?:bundle|\\d+\\.js)`: `bundle` is for react native, `\\d+\\.js` also but specifically for ram bundles because it\n// generates filenames without a prefix like `file://` the filenames in the stacktrace are just 42.js\n// We need this specific case for now because we want no other regex to match.\nconst geckoREgex =\n  /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\\/.*?|\\[native code\\]|[^@]*(?:bundle|\\d+\\.js)|\\/[\\w\\-. /=]+)(?::(\\d+))?(?::(\\d+))?\\s*$/i;\nconst geckoEvalRegex = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i;\n\nconst gecko: StackLineParserFn = line => {\n  const parts = geckoREgex.exec(line);\n\n  if (parts) {\n    const isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\n    if (isEval) {\n      const subMatch = geckoEvalRegex.exec(parts[3]);\n\n      if (subMatch) {\n        // throw out eval line/column and use top-most line number\n        parts[1] = parts[1] || 'eval';\n        parts[3] = subMatch[1];\n        parts[4] = subMatch[2];\n        parts[5] = ''; // no column when eval\n      }\n    }\n\n    let filename = parts[3];\n    let func = parts[1] || UNKNOWN_FUNCTION;\n    [func, filename] = extractSafariExtensionDetails(func, filename);\n\n    return createFrame(filename, func, parts[4] ? +parts[4] : undefined, parts[5] ? +parts[5] : undefined);\n  }\n\n  return;\n};\n\nexport const geckoStackParser: StackLineParser = [GECKO_PRIORITY, gecko];\n\nconst winjsRegex =\n  /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i;\n\nconst winjs: StackLineParserFn = line => {\n  const parts = winjsRegex.exec(line);\n\n  return parts\n    ? createFrame(parts[2], parts[1] || UNKNOWN_FUNCTION, +parts[3], parts[4] ? +parts[4] : undefined)\n    : undefined;\n};\n\nexport const winjsStackParser: StackLineParser = [WINJS_PRIORITY, winjs];\n\nconst opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i;\n\nconst opera10: StackLineParserFn = line => {\n  const parts = opera10Regex.exec(line);\n  return parts ? createFrame(parts[2], parts[3] || UNKNOWN_FUNCTION, +parts[1]) : undefined;\n};\n\nexport const opera10StackParser: StackLineParser = [OPERA10_PRIORITY, opera10];\n\nconst opera11Regex =\n  / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\\(.*\\))? in (.*):\\s*$/i;\n\nconst opera11: StackLineParserFn = line => {\n  const parts = opera11Regex.exec(line);\n  return parts ? createFrame(parts[5], parts[3] || parts[4] || UNKNOWN_FUNCTION, +parts[1], +parts[2]) : undefined;\n};\n\nexport const opera11StackParser: StackLineParser = [OPERA11_PRIORITY, opera11];\n\n/**\n * Safari web extensions, starting version unknown, can produce \"frames-only\" stacktraces.\n * What it means, is that instead of format like:\n *\n * Error: wat\n *   at function@url:row:col\n *   at function@url:row:col\n *   at function@url:row:col\n *\n * it produces something like:\n *\n *   function@url:row:col\n *   function@url:row:col\n *   function@url:row:col\n *\n * Because of that, it won't be captured by `chrome` RegExp and will fall into `Gecko` branch.\n * This function is extracted so that we can use it in both places without duplicating the logic.\n * Unfortunately \"just\" changing RegExp is too complicated now and making it pass all tests\n * and fix this case seems like an impossible, or at least way too time-consuming task.\n */\nconst extractSafariExtensionDetails = (func: string, filename: string): [string, string] => {\n  const isSafariExtension = func.indexOf('safari-extension') !== -1;\n  const isSafariWebExtension = func.indexOf('safari-web-extension') !== -1;\n\n  return isSafariExtension || isSafariWebExtension\n    ? [\n        func.indexOf('@') !== -1 ? func.split('@')[0] : UNKNOWN_FUNCTION,\n        isSafariExtension ? `safari-extension:${filename}` : `safari-web-extension:${filename}`,\n      ]\n    : [func, filename];\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}