{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { getGlobalObject } from '@sentry/utils';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport * as React from 'react';\n/* eslint-enable @typescript-eslint/no-explicit-any */\nvar global = getGlobalObject();\nvar activeTransaction;\nexport function reactRouterV4Instrumentation(history, routes, matchPath) {\n  return createReactRouterInstrumentation(history, 'react-router-v4', routes, matchPath);\n}\nexport function reactRouterV5Instrumentation(history, routes, matchPath) {\n  return createReactRouterInstrumentation(history, 'react-router-v5', routes, matchPath);\n}\nfunction createReactRouterInstrumentation(history, name, allRoutes, matchPath) {\n  if (allRoutes === void 0) {\n    allRoutes = [];\n  }\n  function getInitPathName() {\n    if (history && history.location) {\n      return history.location.pathname;\n    }\n    if (global && global.location) {\n      return global.location.pathname;\n    }\n    return undefined;\n  }\n  function getTransactionName(pathname) {\n    if (allRoutes.length === 0 || !matchPath) {\n      return pathname;\n    }\n    var branches = matchRoutes(allRoutes, pathname, matchPath);\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (var x = 0; x < branches.length; x++) {\n      if (branches[x].match.isExact) {\n        return branches[x].match.path;\n      }\n    }\n    return pathname;\n  }\n  return function (customStartTransaction, startTransactionOnPageLoad, startTransactionOnLocationChange) {\n    if (startTransactionOnPageLoad === void 0) {\n      startTransactionOnPageLoad = true;\n    }\n    if (startTransactionOnLocationChange === void 0) {\n      startTransactionOnLocationChange = true;\n    }\n    var initPathName = getInitPathName();\n    if (startTransactionOnPageLoad && initPathName) {\n      activeTransaction = customStartTransaction({\n        name: getTransactionName(initPathName),\n        op: 'pageload',\n        tags: {\n          'routing.instrumentation': name\n        }\n      });\n    }\n    if (startTransactionOnLocationChange && history.listen) {\n      history.listen(function (location, action) {\n        if (action && (action === 'PUSH' || action === 'POP')) {\n          if (activeTransaction) {\n            activeTransaction.finish();\n          }\n          var tags = {\n            'routing.instrumentation': name\n          };\n          activeTransaction = customStartTransaction({\n            name: getTransactionName(location.pathname),\n            op: 'navigation',\n            tags: tags\n          });\n        }\n      });\n    }\n  };\n}\n/**\n * Matches a set of routes to a pathname\n * Based on implementation from\n */\nfunction matchRoutes(routes, pathname, matchPath, branch) {\n  if (branch === void 0) {\n    branch = [];\n  }\n  routes.some(function (route) {\n    var match = route.path ? matchPath(pathname, route) : branch.length ? branch[branch.length - 1].match // use parent match\n    : computeRootMatch(pathname); // use default \"root\" match\n    if (match) {\n      branch.push({\n        route: route,\n        match: match\n      });\n      if (route.routes) {\n        matchRoutes(route.routes, pathname, matchPath, branch);\n      }\n    }\n    return !!match;\n  });\n  return branch;\n}\nfunction computeRootMatch(pathname) {\n  return {\n    path: '/',\n    url: '/',\n    params: {},\n    isExact: pathname === '/'\n  };\n}\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access */\nexport function withSentryRouting(Route) {\n  var componentDisplayName = Route.displayName || Route.name;\n  var WrappedRoute = function (props) {\n    if (activeTransaction && props && props.computedMatch && props.computedMatch.isExact) {\n      activeTransaction.setName(props.computedMatch.path);\n    }\n    // @ts-ignore Setting more specific React Component typing for `R` generic above\n    // will break advanced type inference done by react router params:\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/blob/13dc4235c069e25fe7ee16e11f529d909f9f3ff8/types/react-router/index.d.ts#L154-L164\n    return React.createElement(Route, __assign({}, props));\n  };\n  WrappedRoute.displayName = \"sentryRoute(\" + componentDisplayName + \")\";\n  hoistNonReactStatics(WrappedRoute, Route);\n  // @ts-ignore Setting more specific React Component typing for `R` generic above\n  // will break advanced type inference done by react router params:\n  // https://github.com/DefinitelyTyped/DefinitelyTyped/blob/13dc4235c069e25fe7ee16e11f529d909f9f3ff8/types/react-router/index.d.ts#L154-L164\n  return WrappedRoute;\n}\n/* eslint-enable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access */","map":{"version":3,"names":["getGlobalObject","hoistNonReactStatics","React","global","activeTransaction","reactRouterV4Instrumentation","history","routes","matchPath","createReactRouterInstrumentation","reactRouterV5Instrumentation","name","allRoutes","getInitPathName","location","pathname","undefined","getTransactionName","length","branches","matchRoutes","x","match","isExact","path","customStartTransaction","startTransactionOnPageLoad","startTransactionOnLocationChange","initPathName","op","tags","listen","action","finish","branch","some","route","computeRootMatch","push","url","params","withSentryRouting","Route","componentDisplayName","displayName","WrappedRoute","props","computedMatch","setName","createElement","__assign"],"sources":["../../src/reactrouter.tsx"],"sourcesContent":["import { Transaction } from '@sentry/types';\nimport { getGlobalObject } from '@sentry/utils';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport * as React from 'react';\n\nimport { Action, Location, ReactRouterInstrumentation } from './types';\n\n// We need to disable eslint no-explict-any because any is required for the\n// react-router typings.\n/* eslint-disable @typescript-eslint/no-explicit-any */\ntype Match = { path: string; url: string; params: Record<string, any>; isExact: boolean };\n\nexport type RouterHistory = {\n  location?: Location;\n  listen?(cb: (location: Location, action: Action) => void): void;\n} & Record<string, any>;\n\nexport type RouteConfig = {\n  [propName: string]: any;\n  path?: string | string[];\n  exact?: boolean;\n  component?: JSX.Element;\n  routes?: RouteConfig[];\n};\n\ntype MatchPath = (pathname: string, props: string | string[] | any, parent?: Match | null) => Match | null;\n/* eslint-enable @typescript-eslint/no-explicit-any */\n\nconst global = getGlobalObject<Window>();\n\nlet activeTransaction: Transaction | undefined;\n\nexport function reactRouterV4Instrumentation(\n  history: RouterHistory,\n  routes?: RouteConfig[],\n  matchPath?: MatchPath,\n): ReactRouterInstrumentation {\n  return createReactRouterInstrumentation(history, 'react-router-v4', routes, matchPath);\n}\n\nexport function reactRouterV5Instrumentation(\n  history: RouterHistory,\n  routes?: RouteConfig[],\n  matchPath?: MatchPath,\n): ReactRouterInstrumentation {\n  return createReactRouterInstrumentation(history, 'react-router-v5', routes, matchPath);\n}\n\nfunction createReactRouterInstrumentation(\n  history: RouterHistory,\n  name: string,\n  allRoutes: RouteConfig[] = [],\n  matchPath?: MatchPath,\n): ReactRouterInstrumentation {\n  function getInitPathName(): string | undefined {\n    if (history && history.location) {\n      return history.location.pathname;\n    }\n\n    if (global && global.location) {\n      return global.location.pathname;\n    }\n\n    return undefined;\n  }\n\n  function getTransactionName(pathname: string): string {\n    if (allRoutes.length === 0 || !matchPath) {\n      return pathname;\n    }\n\n    const branches = matchRoutes(allRoutes, pathname, matchPath);\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let x = 0; x < branches.length; x++) {\n      if (branches[x].match.isExact) {\n        return branches[x].match.path;\n      }\n    }\n\n    return pathname;\n  }\n\n  return (customStartTransaction, startTransactionOnPageLoad = true, startTransactionOnLocationChange = true): void => {\n    const initPathName = getInitPathName();\n    if (startTransactionOnPageLoad && initPathName) {\n      activeTransaction = customStartTransaction({\n        name: getTransactionName(initPathName),\n        op: 'pageload',\n        tags: {\n          'routing.instrumentation': name,\n        },\n      });\n    }\n\n    if (startTransactionOnLocationChange && history.listen) {\n      history.listen((location, action) => {\n        if (action && (action === 'PUSH' || action === 'POP')) {\n          if (activeTransaction) {\n            activeTransaction.finish();\n          }\n          const tags = {\n            'routing.instrumentation': name,\n          };\n\n          activeTransaction = customStartTransaction({\n            name: getTransactionName(location.pathname),\n            op: 'navigation',\n            tags,\n          });\n        }\n      });\n    }\n  };\n}\n\n/**\n * Matches a set of routes to a pathname\n * Based on implementation from\n */\nfunction matchRoutes(\n  routes: RouteConfig[],\n  pathname: string,\n  matchPath: MatchPath,\n  branch: Array<{ route: RouteConfig; match: Match }> = [],\n): Array<{ route: RouteConfig; match: Match }> {\n  routes.some(route => {\n    const match = route.path\n      ? matchPath(pathname, route)\n      : branch.length\n      ? branch[branch.length - 1].match // use parent match\n      : computeRootMatch(pathname); // use default \"root\" match\n\n    if (match) {\n      branch.push({ route, match });\n\n      if (route.routes) {\n        matchRoutes(route.routes, pathname, matchPath, branch);\n      }\n    }\n\n    return !!match;\n  });\n\n  return branch;\n}\n\nfunction computeRootMatch(pathname: string): Match {\n  return { path: '/', url: '/', params: {}, isExact: pathname === '/' };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access */\nexport function withSentryRouting<P extends Record<string, any>, R extends React.ComponentType<P>>(Route: R): R {\n  const componentDisplayName = (Route as any).displayName || (Route as any).name;\n\n  const WrappedRoute: React.FC<P> = (props: P) => {\n    if (activeTransaction && props && props.computedMatch && props.computedMatch.isExact) {\n      activeTransaction.setName(props.computedMatch.path);\n    }\n\n    // @ts-ignore Setting more specific React Component typing for `R` generic above\n    // will break advanced type inference done by react router params:\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/blob/13dc4235c069e25fe7ee16e11f529d909f9f3ff8/types/react-router/index.d.ts#L154-L164\n    return <Route {...props} />;\n  };\n\n  WrappedRoute.displayName = `sentryRoute(${componentDisplayName})`;\n  hoistNonReactStatics(WrappedRoute, Route);\n  // @ts-ignore Setting more specific React Component typing for `R` generic above\n  // will break advanced type inference done by react router params:\n  // https://github.com/DefinitelyTyped/DefinitelyTyped/blob/13dc4235c069e25fe7ee16e11f529d909f9f3ff8/types/react-router/index.d.ts#L154-L164\n  return WrappedRoute;\n}\n/* eslint-enable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access */\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}